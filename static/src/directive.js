angular.module("Directive",[]).directive("sliderAnimate",[function(){return{scope:{animate:"=animation"},link:function(e,n,t,r){e.animate()}}}]).directive("alertAnimate",[function(){return{scope:{message:"=alertText"},link:function(e,n,t,r){e.$watch("message",function(r,i){r&&(n[0].addEventListener("animationend",function(){n.removeClass(t.animation),n[0].removeEventListener("animationend"),e.message=""}),n.addClass(t.animation))})}}}]).directive("optionClick",["orderService",function(e){return{link:function(n,t,r,i){t.on("change",function(){var i=n.$watchCollection("sceneParams",function(t,r){t&&e.getProductScenes(t).success(function(e){n.scene=e,n.sceneParams.SID=e.DefaultScene.scene_id})}),o=r.optionClick,c=n.sceneParams;n.$apply(function(){0===Number(o)?c.SceneName=t.val():1==o?c.SceneLocation=t.val():2==o&&(c.SceneTimeperiod=t.val())}),i()})}}}]).directive("useDiscount",["$http","orderService",function(e,n){return{link:function(t,r,i,o){r.on("click",function(){if("1"==i.useDiscount){var r="";for(var o in t.ipt)r+=t.ipt[o];e({method:"POST",url:"/product/"+n.getProductId()+"/c2discount/validate",params:{C2DiscountNO:r,_xsrf:document.querySelector('[name="_xsrf"]').value}}).success(function(e){1!=e.result?(t.errormsg=e.errormsg,t.errorstyle={color:"red"}):(t.priceOffset.c2discountno=r,t.errorstyle={},t.errormsg="",t.priceOffset.discountAmount=e.DiscountAmount,t.discountStyle={color:"green","font-weight":"bold"},angular.element(".overlay").fadeOut(200),angular.element(".under").fadeOut(200))})}else"0"==i.useDiscount&&t.$apply(function(){t.errorstyle={},t.errormsg=""})})}}}]).directive("couponDraw",["orderService",function(e){return{link:function(n,t,r,i){t.on("click",function(){return 1==n.isDrawed?!1:void e.couponUserDraw({json:angular.toJson({PID:n.product_id})}).success(function(e){var t,r=e.result;0===Number(r)?t="用户已领取优惠券":1==r?(t="用户领取优惠券成功",n.tip="您已经领取此优惠券",n.isDrawed=!0):-1==r?t="商品可领取的优惠券金额为0":-2==r&&(t="商品无优惠券可供领取"),alert(t)})})}}}]).directive("twinbutton",[function(){return{scope:{count:"=",max:"=",price:"="},restrict:"E",replace:!0,templateUrl:"twinbutton.html",link:function(e,n,t,r){e.counter=function(n){e.count+=n},e.$watch("count",function(n,t){n>e.max?e.count=e.max:1>n&&(e.count=1)})}}}]);